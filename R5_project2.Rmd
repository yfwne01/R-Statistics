---
title: "project"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
#storm data analysis
#data loading
StormData <- read.csv("repdata_data_StormData.csv")
DamagesCols <- c('BGN_DATE', 'EVTYPE', 'PROPDMG', 'PROPDMGEXP', 'FATALITIES', 'INJURIES')
StormDamagesData <- StormData[, DamagesCols]
StormDamagesData$EVTYPE <- toupper(StormDamagesData$EVTYPE)

StormDamagesData$c4 <- ifelse(StormDamagesData$PROPDMGEXP == "K", '1000',
                  ifelse(StormDamagesData$PROPDMGEXP == "M", '1000000',
                         ifelse(StormDamagesData$PROPDMGEXP == "B", '1000000000','0')))
StormDamagesData <- transform(StormDamagesData, c4 = as.numeric(c4), PROPDMGEXP = as.numeric(PROPDMGEXP))
#calculate the damage cost,facilities and injuries aggregating by the event type
StormDamagesData$Damages <- StormDamagesData$PROPDMG * StormDamagesData$c4

TypeDamageSum <- aggregate(StormDamagesData$Damages, by=list(EVTYPE=StormDamagesData$EVTYPE), FUN=sum)

TypeHealthSum <- aggregate(cbind(FATALITIES, INJURIES) ~ EVTYPE, data = StormDamagesData, sum)

#keep the top 10 biggest damages/Fatalities and multiply cost by 1 Billion for ease of display
TypeHealthSum <- TypeHealthSum[with(TypeHealthSum,order(-TypeHealthSum$FATALITIES)),]
TypeHealthSum <- TypeHealthSum[1:10,]

TypeDamageSum <- TypeDamageSum[with(TypeDamageSum,order(-TypeDamageSum$x)),]
TypeDamageSum <- TypeDamageSum[1:10,]
TypeDamageSum$x <- TypeDamageSum$x / 1000000000

#bar plot
TypeHealthSum$FATALITIES <- as.integer(TypeHealthSum$FATALITIES)
TypeHealthSum$INJURIES <- as.integer(TypeHealthSum$INJURIES)
mx <- t(as.matrix(TypeHealthSum[-1]))
colnames(mx) <- TypeHealthSum$EVTYPE

```

